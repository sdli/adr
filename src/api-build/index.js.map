{"version":3,"sources":["../api/index.js"],"names":["app","port","apiPort","use","secret","resave","saveUninitialized","cookie","secure","urlencoded","extended","post","req","res","next","sess","session","username","body","password","count","result","status","code","msg","setHeader","json","save","loginStatus","get","pngNum","parseInt","Math","random","p","color","img","getBase64","imgbase64","Buffer","writeHead","end","listen","error","console","info"],"mappings":"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","file":"index.js","sourcesContent":["import express from 'express';\nimport bodyParser from \"body-parser\";\nimport configs from \"./utils/configs\"; \nimport session from \"express-session\";\nimport captchapng from 'captchapng';\nimport cookieParser from \"cookie-parser\";\n\nconst app = new express();\nconst port  = configs.apiPort;\napp.use(cookieParser());\napp.use(session({\n  secret: 'sessiontest',\n  resave: true,\n  saveUninitialized: false,\n  cookie: {secure: false}\n}));\n\napp.use(bodyParser.urlencoded({ extended: false}));\n\n// setResponse(app);\napp.post('/login',function(req,res,next){\n    let sess = req.session;\n    let username = req.body.username;\n    let password = req.body.password;\n    if(sess.count){\n        sess.count++;\n    }else{\n        sess.count =1;\n    }\n    if(username == '123' && password == '123'){\n\n        const result = {\n            status: 1,\n            code: '1',\n            msg: 'succ',\n            count: sess.count,\n        };\n        sess.status = 1;\n        sess.username = username;\n        res.setHeader(\"Content-Type\",\"application/json\");\n        res.json(result);\n        sess.save();\n    }else{\n        const result = {\n            status: 0,\n            code: '0',\n            msg: 'fail',\n            count: sess.count,\n            username: username\n        };\n        sess.status = 0;\n        res.setHeader(\"Content-Type\",\"application/json\");\n        res.json(result);\n    }\n});\n\napp.post('/loadAuth',function(req,res,next){\n  let loginStatus = (typeof req.session.status === \"undefined\")?false:req.session.status;\n  if(loginStatus){\n      let result = {\n          code : '1',\n          username: req.session.username,\n          msg : 'login auth OK!'\n      };\n      res.setHeader(\"Access-Control-Allow-Origin\",\"*\");\n      res.setHeader(\"Content-Type\",\"application/json\");\n      res.json(result);\n  }else{\n    let result = {\n        code : '0',\n        username: \"steven?\",\n        msg : 'no auth!'\n    };\n    res.setHeader(\"Access-Control-Allow-Origin\",\"*\");\n    res.setHeader(\"Content-Type\",\"application/json\");\n    res.json(result);\n  }\n});\n\napp.get('/img',function(req,res,next){\n    var pngNum = parseInt(Math.random()*9000+1000);\n    req.session.pngNum = pngNum;\n    var p = new captchapng(80,30,parseInt(Math.random()*9000+1000)); // width,height,numeric captcha \n    p.color(0, 0, 0, 0);  // First color: background (red, green, blue, alpha) \n    p.color(80, 80, 80, 255); // Second color: paint (red, green, blue, alpha) \n\n    var img = p.getBase64();\n    var imgbase64 = new Buffer(img,'base64');\n    res.writeHead(200, {\n        'Content-Type': 'image/png'\n    });\n    res.end(imgbase64);\n    next();\n});\n\napp.listen(port,function(error) {\n  if (error) {\n    console.error(error)\n  } else {\n    console.info(\"==> ðŸŒŽ  API listening on port %s. Open up http://localhost:%s/ in your browser.\", port, port)\n  }\n});"]}